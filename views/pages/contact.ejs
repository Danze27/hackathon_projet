<div class="contact-page">
  <h1 class="contact-title">Contact us</h1>
  <p class="contact-subtitle">
    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  </p>

  <form id="contactForm" class="contact-form">
    <div class="form-group">
      <label for="nom">Name*</label>
      <input
        type="text"
        id="nom"
        name="nom"
        required
        placeholder="Votre nom"
        autocomplete="name"
      />
    </div>

    <div class="form-group">
      <label for="email">Email*</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        placeholder="vous@exemple.com"
        autocomplete="email"
      />
    </div>

    <div class="form-group">
      <label for="message">Message*</label>
      <textarea
        id="message"
        name="message"
        rows="7"
        required
        placeholder="Tapez votre message..."
      ></textarea>
    </div>

    <div class="form-group form-inline">
      <input type="checkbox" id="terms" name="terms" required />
      <label for="terms"
        >J'accepte les
        <a href="/terms" target="_blank" rel="noopener">Terms</a></label
      >
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Submit</button>
    </div>
  </form>

  <div id="formMessage" style="margin-top: 15px"></div>
</div>
<script>
  document
    .getElementById("contactForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const messageBox = document.getElementById("formMessage");

      const data = {
        nom: form.nom.value,
        email: form.email.value,
        message: form.message.value,
        terms: form.terms.checked ? "on" : "",
      };

      try {
        const res = await fetch("/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await res.json();

        if (res.ok) {
          messageBox.innerHTML = `<div class="alert alert-success">${result.success}</div>`;
          form.reset();
          setTimeout(() => (messageBox.innerHTML = ""), 4000);
        } else {
          messageBox.innerHTML = result.errors
            .map((err) => `<div class="alert alert-error">${err.msg}</div>`)
            .join("");
        }
      } catch (err) {
        messageBox.innerHTML = `<div class="alert alert-error">Erreur de connexion au serveur.</div>`;
      }
    });
</script>
